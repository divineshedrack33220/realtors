<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Read the latest blog posts from INTO REALTORS about real estate in Abuja.">
    <title>INTO REALTORS | Blog</title>
    <script src="https://cdn.tailwindcss.com"></script>
     <link rel="icon" type="image/png" href="/admin/logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background: #f9fafb;
        }

        /* Custom Scrollbar (Desktop Only) */
        @media (min-width: 1024px) {
            html {
                scrollbar-width: thin;
                scrollbar-color: #FF5A3C #f1f5f9;
            }
            ::-webkit-scrollbar {
                width: 8px;
            }
            ::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 4px;
            }
            ::-webkit-scrollbar-thumb {
                background: #FF5A3C;
                border-radius: 4px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            ::-webkit-scrollbar-thumb:hover {
                background: #e04a2f;
            }
        }

        /* Loader */
        .loader {
            width: 40px;
            aspect-ratio: 1;
            color: #FF5A3C;
            position: relative;
            background: radial-gradient(10px, currentColor 94%, #0000);
            margin: 2rem auto;
        }
        .loader:before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background:
                radial-gradient(9px at bottom right, #0000 94%, currentColor) top left,
                radial-gradient(9px at bottom left, #0000 94%, currentColor) top right,
                radial-gradient(9px at top right, #0000 94%, currentColor) bottom left,
                radial-gradient(9px at top left, #0000 94%, currentColor) bottom right;
            background-size: 20px 20px;
            background-repeat: no-repeat;
            animation: l18 1.5s infinite cubic-bezier(0.3, 1, 0, 1);
        }
        @keyframes l18 {
            33%  { inset: -10px; transform: rotate(0deg) }
            66%  { inset: -10px; transform: rotate(90deg) }
            100% { inset: 0; transform: rotate(90deg) }
        }

        /* Shimmer */
        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Scrollable Content */
        .content-container {
            max-height: calc(100vh - 120px); /* Adjusted for top nav and floating buttons */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            padding: 1rem;
        }
        .content-container::-webkit-scrollbar {
            display: none;
        }
        .content-container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }

        /* Back to Top and WhatsApp Buttons */
        .back-to-top, .whatsapp-float {
            position: fixed;
            bottom: 2rem;
            right: 1rem;
            background: #FF5A3C;
            color: white;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 60;
        }
        .whatsapp-float {
            background: #25D366;
            bottom: 5rem;
        }
        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        .back-to-top:hover, .whatsapp-float:hover {
            transform: scale(1.1);
            outline: 2px solid #FF5A3C;
        }
        .whatsapp-float:hover {
            background: #1EBE57;
            outline: 2px solid #25D366;
        }

        /* Responsive Adjustments */
        @media (max-width: 639px) {
            .back-to-top, .whatsapp-float {
                width: 2rem;
                height: 2rem;
                right: 0.75rem;
                transform: scale(0.9);
            }
            .back-to-top:hover, .whatsapp-float:hover {
                transform: scale(1);
            }
            .back-to-top {
                bottom: 1.5rem;
            }
            .whatsapp-float {
                bottom: 4rem;
            }
        }
        @media (min-width: 1024px) {
            .back-to-top, .whatsapp-float {
                bottom: 2rem;
                right: 2rem;
            }
            .whatsapp-float {
                bottom: 5rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Top Navigation -->
    <nav class="sticky top-0 z-50 bg-white shadow-md py-3 px-4 flex justify-between items-center" role="navigation" aria-label="Main navigation">
        <div class="text-center flex-1">
            <span class="text-[#FF5A3C] font-bold text-xl">INTO REALTORS</span>
        </div>
        <a href="index.html" id="back-button" class="text-gray-600 hover:text-[#FF5A3C]">
            <i class="fas fa-arrow-left text-lg"></i>
        </a>
    </nav>

    <!-- Blog Details Section -->
    <section class="py-10 px-4 bg-gray-50">
        <div class="container mx-auto max-w-4xl">
            <div id="blog-content" class="bg-white rounded-xl shadow-md p-6 content-container">
                <div class="loader"></div>
            </div>
        </div>
    </section>

    <!-- WhatsApp Floating Icon -->
    <a href="https://wa.me/+23470314517217?text=Hello, I'm interested in learning more about INTO REALTORS." class="whatsapp-float" aria-label="Contact us via WhatsApp">
        <i class="fab fa-whatsapp text-xl"></i>
    </a>

    <!-- Back to Top Button -->
    <a href="#" class="back-to-top" aria-label="Back to top">
        <i class="fas fa-chevron-up text-xl"></i>
    </a>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Client-side ObjectId validation
            function isValidObjectId(id) {
                return /^[0-9a-fA-F]{24}$/.test(id);
            }

            // Fetch Blog Post
            async function fetchBlog() {
                const blogContent = document.getElementById('blog-content');
                blogContent.innerHTML = '<div class="loader"></div>';
                try {
                    const urlParams = new URLSearchParams(window.location.search);
                    const id = urlParams.get('id');
                    if (!id) {
                        throw new Error('No blog ID provided');
                    }
                    if (!isValidObjectId(id)) {
                        throw new Error('Invalid blog ID format');
                    }
                    const response = await fetch(`https://intorealtors.onrender.com/api/blogs/${id}`);
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        if (response.status === 404) {
                            throw new Error('Blog post not found');
                        }
                        if (response.status === 401) {
                            throw new Error('Unauthorized access');
                        }
                        throw new Error(errorData.error || `Failed to fetch blog post (Status: ${response.status})`);
                    }
                    const blog = await response.json();
                    blogContent.innerHTML = `
                        <div class="relative h-64 mb-6">
                            <div class="shimmer w-full h-full rounded-xl"></div>
                            <img src="${blog.image}" alt="${blog.alt}" class="w-full h-full object-cover rounded-xl" loading="lazy">
                        </div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">${blog.title}</h1>
                        <p class="text-sm text-gray-500 mb-4">Published on ${new Date(blog.date).toLocaleDateString()}</p>
                        <p class="text-sm text-gray-600 mb-4">${blog.description}</p>
                        <p class="text-sm text-gray-600">${blog.content}</p>
                    `;
                    const img = blogContent.querySelector('img');
                    img.addEventListener('load', () => {
                        img.classList.add('loaded');
                        img.classList.remove('shimmer');
                        const shimmerDiv = img.parentElement.querySelector('.shimmer');
                        if (shimmerDiv) shimmerDiv.style.display = 'none';
                    });
                    img.addEventListener('error', () => {
                        console.warn(`Failed to load blog image: ${img.src}`);
                        img.src = 'https://via.placeholder.com/1170x400';
                    });
                } catch (error) {
                    console.error('Error fetching blog:', error.message, error.stack);
                    blogContent.innerHTML = `<p class="text-center text-red-600">Failed to load blog post: ${error.message}</p>`;
                }
            }

            // Back to Top Button
            const backToTopButton = document.querySelector('.back-to-top');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTopButton.classList.add('visible');
                } else {
                    backToTopButton.classList.remove('visible');
                }
            });

            backToTopButton.addEventListener('click', (e) => {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // Back Button
            const backButton = document.getElementById('back-button');
            backButton.addEventListener('click', (e) => {
                e.preventDefault();
                window.history.back();
            });

            // Load Blog
            fetchBlog();
        });
    </script>
</body>
</html>
